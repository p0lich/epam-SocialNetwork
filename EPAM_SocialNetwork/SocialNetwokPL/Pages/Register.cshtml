@using System.IO
@using Entities;
@using Dependencies;
@using EPAM.SocialNetwork.BLL.Interfaces;

@{
    FormsAuthentication.SignOut();

    Layout = "~/Pages/Layouts/_BasicLayout.cshtml";

    ILogic logic = DependencyResolver.GetInstance().UserLogic;
}

@{
    if (IsPost)
    {
        if (Request["userPassword"] == Request["userRepPassword"])
        {
            if (logic.IsLoginUnique(Request["userLogin"]))
            {
                User user = new User(
                    id: 0,
                    login: Request["userLogin"],
                    password: Request["userPassword"],
                    gender: "m",
                    firstName: Request["userFirstName"],
                    lastName: Request["userLastName"],
                    dateOfBirth: Request["userDateOfBirth"].AsDateTime(),
                    imagePath: null
                    );

                logic.CreateUser(user);

                FormsAuthentication.SetAuthCookie(user.Login, true);

                Response.Redirect("~/Pages/UserPage.cshtml");
            }
        }
    }
}

<form method="post">
    <div class="form-row">
        <div class="form-group col-md-6">
            <label for="inputLogin">Login</label>
            <input type="text" class="form-control" id="inputLogin" placeholder="Login" name="userLogin">
        </div>
        <div class="form-group col-md-6">
            <label for="inputPassword">Password</label>
            <input type="password" class="form-control" id="inputPassword" placeholder="Password" name="userPassword">
        </div>
        <div class="form-group col-md-6">
            <label for="inputPassword2">Repeat password</label>
            <input type="password" class="form-control" id="inputPassword2" placeholder="Repeat password" name="userRepPassword">
        </div>
        <p>Unnecessary parameters</p>
        <div class="form-group col-md-6">
            <label for="inputFirstName">First name</label>
            <input type="text" class="form-control" id="inputFirstName" placeholder="First name" name="userFirstName">
        </div>
        <div class="form-group col-md-6">
            <label for="inputLastName">Last name</label>
            <input type="text" class="form-control" id="inputLastName" placeholder="Last name" name="userLastName">
        </div>
        <div class="form-group col-md-6">
            <label for="inputDateOfBirth">Date of birth</label>
            <input type="text" class="form-control" id="inputDateOfBirth" placeholder="Date of birth" name="userDateOfBirth">
        </div>
        <div class="form-group col-md-6">
            <label for="downloadImage">Image</label>
        </div>
    </div>
    <div class="form-group">
        <label for="Gender">Gender</label>
        <input type="text" class="form-control" id="Gender" placeholder="not implemented">
    </div>
    <div class="form-group">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="gridCheck">
            <label class="form-check-label" for="gridCheck">
                Check me out
            </label>
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Sign in</button>
</form>